<html>
	<head>
		<title>Planner</title>
		<link rel="icon" type="image/png" href="0.png">
	</head>
  <body>
    <div id="scr"></div> 
	  <button onclick="eval('localStorage.usr = undefined')">Log out</button> | <button onclick="tryLoad()">Log in</button> | <button onclick="tryCreate()">Create account</button> | <button onclick="tryNew()">New Chat</button>	  
  </body>
  <script src="main.js"></script>
  <script>
	  function tryNewDo(e){
	  	var newChat = prompt("New chat name")
		var newId = newChat + Math.floor(Math.random() * 100000000) + newChat;
		var users = prompt("Users that will join the chat (separated by ', ')").split(", ")
		users.push(localStorage.usr)
		res.data.chats.push(newId)
		ruptade("chats", res.data.chats)
		for(usere in users){
			if(res.data.users.includes(usere)){
				user.data[user].chats.push({'name': newChat, 'id': newId})
				uuptade(usere, user.data[usere])
			}
			else{
				console.log("Unexisting user.")
			}
		}
		db.data[newId] = {newId: [{'text': localStorage.usr + ' created this chat.', 'user':'admin'}]};
		update(newId, db.data[newId])
	  }
	  function tryNewUser(e){
		  get()
	  	uget("63c54a8c15ab31599e37f4e6","tryNewDo")
	  }
	  function tryNew(){
	  	rget("63c54a8c15ab31599e37f4e6","tryNewUser")
	  }
	  function createUsmr(e){
	  	uget("63c54a8c15ab31599e37f4e6","createUsr")
	  }
	  function createUsr(e){
	  	var userdo = prompt("Input your new user.")
		if(res.data.users.includes(userdo)){
			alert("User already in use.")
		}
		else{
			res.data.users.push(userdo)
			console.log(res.data.users)
                        var pass = prompt("Input new password");
			var uptape = {"pass":pass,"chats":[{'name':'All users','id':'key'}]};
			console.log(uptape)
			uuptade(userdo, uptape)                                                               
			ruptade("users",res.data.users)
		}
                               
	  }
	  function tryCreate(){
	  	rget("63c54a8c15ab31599e37f4e6","createUsmr")
	  }
	  function tryLoad(){
		 uget("63c44219dfc68e59d5834ba0", "userLoad")
	  }
      function userLoad(e){
		var c = new URLSearchParams(window.location.search).get('c');
		var posuser = prompt("You are not signed in. Please, write your username.");
		 var password = prompt("Write here your password.")
		 if(e[posuser].pass == password){
		 	localStorage.usr = posuser;
		 }
		else{
			alert("Incorrect password or user. Try again.")
			window.location.reload()
		  }
    }
    function loadChats(e){
      var chats = e[localStorage.usr].chats;
      console.log(chats)
      for(c in chats){
        document.getElementById("scr").innerHTML = document.getElementById("scr").innerHTML + "<a href='https://code-programer.github.io/planner/chat?rea&c=" + chats[c].id + "'>" + chats[c].name + "</a><br>"
      }
    }
    window.onload = function(){
	    uget("63c44219dfc68e59d5834ba0","loadChats")
	    if(localStorage.usr === undefined){
		alert("You are not logged in.")
	  }   
                              }
  </script>
</html>
